<body style="-webkit-app-region: drag; margin: 0;">

    <video id="video" width="100%" height="100%" controls></video>

    <script>
        const {BrowserWindow} = require('electron').remote;
        const ipc = require('electron').ipcRenderer;
        const Hls = require('hls.js');
        const video = document.getElementById('video');

        // get video url from renderer
        ipc.on('video', function(event, video_url, window_id) {

            // play mp4
            if (video_url.includes(".mp4")) {
                video.src = video_url;
                video.play();
                return;
            }

            // play m3u
            const hls = new Hls({fragLoadingMaxRetry: 1});
            hls.loadSource(video_url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, function() {
                video.play();
            });

            // report back if video url is outdated
            hls.on(Hls.Events.ERROR, function(event, data) {
                console.log(data);
                console.log(video_url);
                if (!data.fatal)
                    return;

                console.log('video outdated');
                hls.destroy();
                video.pause();
                BrowserWindow.fromId(window_id).webContents.send('video_outdated');
            });
        });
    </script>

</body>
